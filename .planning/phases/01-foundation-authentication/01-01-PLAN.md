---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
  - postcss.config.mjs
  - src/app/layout.tsx
  - src/app/globals.css
  - src/lib/db.ts
  - prisma/schema.prisma
  - prisma/seed.ts
  - .env.example
  - .env.local
  - .gitignore
  - components.json
autonomous: true
user_setup:
  - service: postgresql
    why: "Database for all application data"
    env_vars:
      - name: DATABASE_URL
        source: "Local PostgreSQL or Supabase Dashboard -> Settings -> Database -> Connection string"

must_haves:
  truths:
    - "Next.js dev server starts without errors on localhost:3000"
    - "Prisma schema validates and migrations run successfully"
    - "Database contains all 6 products with pricing tiers and volume discounts"
    - "Database contains all 7 locations"
    - "Database contains all 9 sales channels"
    - "Database contains 2 admin users (Anthony and Tunde)"
    - "Database contains subscription plan configurations"
    - "Database contains approval workflow thresholds"
    - "Tailwind uses Caribbean color palette (deep green, gold, black)"
    - "shadcn/ui components available for use"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "next"
    - path: "prisma/schema.prisma"
      provides: "Database models for User, Product, Location, SalesChannel, SubscriptionPlan, ApprovalThreshold"
      contains: "model User"
    - path: "prisma/seed.ts"
      provides: "Idempotent seed script for all reference data"
      contains: "upsert"
    - path: "src/lib/db.ts"
      provides: "Prisma client singleton"
      contains: "PrismaClient"
    - path: "tailwind.config.ts"
      provides: "Caribbean color palette configuration"
      contains: "caribbean"
  key_links:
    - from: "prisma/seed.ts"
      to: "prisma/schema.prisma"
      via: "Prisma client uses schema models"
      pattern: "prisma\\.(user|product|location|salesChannel)\\."
    - from: "src/lib/db.ts"
      to: "prisma/schema.prisma"
      via: "PrismaClient generated from schema"
      pattern: "new PrismaClient"
---

<objective>
Initialize the Next.js project with all dependencies, configure the database schema with all foundational models, and seed the database with complete reference data for all 6 products, 7 locations, 9 sales channels, 2 admin users, subscription plans, and approval thresholds.

Purpose: Every subsequent plan depends on having a working Next.js project, database schema, and seeded reference data. This is the foundation all auth and UI work builds on.
Output: Working Next.js app with configured Tailwind (Caribbean palette), shadcn/ui, Prisma schema, and fully seeded database.
</objective>

<execution_context>
@/Users/rfmstaff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rfmstaff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/STRUCTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project with all dependencies and configuration</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    tailwind.config.ts
    postcss.config.mjs
    src/app/layout.tsx
    src/app/globals.css
    src/app/page.tsx
    src/lib/db.ts
    .env.example
    .env.local
    .gitignore
    components.json
  </files>
  <action>
    1. Create Next.js 15+ project in the current directory using `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm`. Accept defaults for other prompts.

    2. Install core dependencies:
       ```bash
       npm install jose bcrypt zod prisma @prisma/client next-themes sonner react-loading-skeleton
       npm install -D @types/bcrypt tsx
       ```

    3. Initialize Prisma:
       ```bash
       npx prisma init --datasource-provider postgresql
       ```

    4. Initialize shadcn/ui:
       ```bash
       npx shadcn@latest init -d
       ```
       Then add essential components:
       ```bash
       npx shadcn@latest add button input label card form toast
       ```

    5. Configure Tailwind with Caribbean color palette in `tailwind.config.ts`:
       - `caribbean.green.DEFAULT`: `#006633` (deep green, primary)
       - `caribbean.green.light`: `#00884D`
       - `caribbean.green.dark`: `#004D26`
       - `caribbean.gold.DEFAULT`: `#D4AF37` (gold accent)
       - `caribbean.gold.light`: `#E5C158`
       - `caribbean.gold.dark`: `#B8941F`
       - `caribbean.black.DEFAULT`: `#1A1A1A` (rich black)
       - `caribbean.black.light`: `#2D2D2D`
       - Enable `darkMode: 'class'`

    6. Create Prisma client singleton in `src/lib/db.ts`:
       - Use the standard Next.js pattern with `globalThis` to prevent multiple instances in dev
       - Export as `db` (not `prisma`)

    7. Create `.env.example` with all required env vars:
       ```
       DATABASE_URL="postgresql://user:password@localhost:5432/jhb_command_center"
       SESSION_SECRET="generate-a-random-32-char-string"
       RESEND_API_KEY=""
       NEXT_PUBLIC_APP_URL="http://localhost:3000"
       ```

    8. Create `.env.local` with DATABASE_URL pointing to local PostgreSQL or Supabase.

    9. Update `src/app/layout.tsx` with basic metadata:
       - Title: "JHB Command Center"
       - Description: "Operations management for Jamaica House Brand LLC"

    10. Update `.gitignore` to include `.env.local`, `node_modules/`, `.next/`, `prisma/*.db`.
  </action>
  <verify>
    ```bash
    npm run dev &
    sleep 5
    curl -s http://localhost:3000 | head -20
    kill %1
    npx prisma validate
    ```
    Dev server starts, returns HTML, and Prisma schema validates.
  </verify>
  <done>
    - `npm run dev` starts Next.js dev server on localhost:3000 without errors
    - `npx prisma validate` passes
    - Tailwind config contains Caribbean color palette
    - shadcn/ui components installed and available
    - Prisma client singleton exists at `src/lib/db.ts`
    - `.env.example` documents all required environment variables
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Prisma schema with all foundational models and seed the database</name>
  <files>
    prisma/schema.prisma
    prisma/seed.ts
    package.json
  </files>
  <action>
    1. Define the complete Prisma schema in `prisma/schema.prisma` with these models:

    **Enums:**
    - `Role`: ADMIN, MANAGER, SALES_REP, INVESTOR
    - `LocationType`: PRODUCTION, RESTAURANT, WAREHOUSE, FULFILLMENT, MARKET, EVENT
    - `ChannelType`: ONLINE, RETAIL, WHOLESALE, MARKETPLACE, SUBSCRIPTION, EVENT

    **Models:**

    `User`:
    - id (String, cuid), email (String, unique), name (String), password (String, nullable for magic link users)
    - role (Role, default SALES_REP), emailVerified (DateTime, nullable), isActive (Boolean, default true)
    - createdAt, updatedAt
    - relations: invitesSent (InviteToken[])

    `Product`:
    - id (String, cuid), name (String), sku (String, unique), size (String), unitsPerCase (Int, nullable)
    - description (String, nullable), isActive (Boolean, default true)
    - createdAt, updatedAt
    - relations: pricingTiers (PricingTier[])

    `PricingTier`:
    - id (String, cuid), productId (String, FK to Product)
    - tierName (String) — e.g., "Wholesale Cash", "Wholesale Net 30", "Retail"
    - unitPrice (Decimal 10,2), casePrice (Decimal 10,2, nullable)
    - createdAt, updatedAt
    - Unique constraint on [productId, tierName]

    `VolumeDiscount`:
    - id (String, cuid), minCases (Int), maxCases (Int, nullable), discountPercent (Decimal 5,2)
    - description (String)
    - createdAt, updatedAt

    `FrequencyDiscount`:
    - id (String, cuid), frequency (String) — "quarterly" or "annual"
    - discountPercent (Decimal 5,2), additionalBenefits (String, nullable)
    - createdAt, updatedAt

    `Location`:
    - id (String, cuid), name (String, unique), type (LocationType)
    - address (String, nullable), description (String, nullable), isActive (Boolean, default true)
    - deliverySchedule (String, nullable) — e.g., "Weekly delivery"
    - createdAt, updatedAt

    `SalesChannel`:
    - id (String, cuid), name (String, unique), type (ChannelType)
    - description (String, nullable), isActive (Boolean, default true)
    - createdAt, updatedAt

    `SubscriptionPlan`:
    - id (String, cuid), name (String, unique), billingCycle (String) — "monthly" or "annual"
    - price (Decimal 10,2), includedProducts (String) — description of what's included
    - loyaltyReward (String, nullable) — e.g., "1 month free at 6 months"
    - cancellationPolicy (String, nullable)
    - isActive (Boolean, default true)
    - createdAt, updatedAt

    `ApprovalThreshold`:
    - id (String, cuid), minAmount (Decimal 10,2), maxAmount (Decimal 10,2, nullable)
    - approvalType (String) — "auto", "single_member", "dual_member", "dual_bank"
    - description (String)
    - createdAt, updatedAt

    `InviteToken`:
    - id (String, cuid), email (String), role (Role), token (String, unique)
    - invitedById (String, FK to User), expiresAt (DateTime)
    - acceptedAt (DateTime, nullable)
    - createdAt, updatedAt

    `MagicLinkToken`:
    - id (String, cuid), email (String), token (String, unique)
    - expiresAt (DateTime), usedAt (DateTime, nullable)
    - createdAt, updatedAt

    2. Create idempotent seed script in `prisma/seed.ts` using tsx runner:

    **Admin users (INFRA-04):**
    - Anthony Amos Jr.: anthony@jamaicahousebrand.com, ADMIN, bcrypt hash with cost 10
    - Olatunde Ogunjulugbe: tunde@jamaicahousebrand.com, ADMIN, bcrypt hash with cost 10
    - Use upsert by email to prevent duplicates
    - Default password: "JHB2026!" (users should change on first login)

    **Products with pricing tiers (INFRA-01):**
    Use exact data from PROJECT.md:
    - Original Jerk Sauce 2oz: sku JHB-OJS-2OZ, 25/case, Wholesale Cash $3.00/unit ($75/case), Retail $3.50-4.00 (use $3.75)
    - Original Jerk Sauce 5oz: sku JHB-OJS-5OZ, 12/case, Wholesale Cash $5.00/unit ($60/case), Wholesale Net 30 $6.25/unit ($75/case), Retail $7.00-8.00 (use $7.50)
    - Original Jerk Sauce 10oz: sku JHB-OJS-10OZ, 12/case, Wholesale Cash $10.00/unit ($110/case), Wholesale Net 30 $12.50/unit ($150/case), Retail $12.00-15.00 (use $13.50)
    - Escovitch/Pikliz 12oz: sku JHB-EP-12OZ, 12/case, Wholesale Cash $4.58/unit ($55/case), Retail $6.00-8.00 (use $7.00)
    - Original Jerk Sauce 1 Gallon: sku JHB-OJS-1GAL, 1/case, Wholesale Cash $80.00, Wholesale Net 30 $100.00 (intro price $50 first 3mo noted in description)
    - Original Jerk Sauce 9g Sachet: sku JHB-OJS-9G, null units/case (TBD), no pricing tiers yet

    For each product, upsert product first, then upsert each pricing tier by [productId, tierName] unique.

    **Volume discounts (INFRA-01):**
    - 1-5 cases: 0% (standard price)
    - 6-10 cases: 5% discount
    - 11+ cases: 10% discount

    **Frequency discounts (INFRA-01):**
    - Quarterly orders: 2% discount
    - Annual contracts: 5% discount + priority allocation

    **Locations (INFRA-02):**
    - Miami Gardens Restaurant: PRODUCTION, "Production facility + restaurant + retail"
    - Broward Blvd Restaurant: RESTAURANT, "Weekly delivery"
    - Miramar Restaurant: RESTAURANT, "Weekly delivery"
    - Amazon FBA Warehouse: FULFILLMENT, "E-commerce fulfillment"
    - Main Warehouse/Storage: WAREHOUSE, "Finished goods + raw materials"
    - Farmers Markets: MARKET, "Rotating South Florida locations"
    - Event/Tailgate Locations: EVENT, "Pop-up sales"

    **Sales channels (INFRA-03):**
    - Amazon: MARKETPLACE
    - Restaurant Retail: RETAIL
    - Wholesale/Distribution: WHOLESALE
    - Farmers Markets: EVENT
    - E-commerce/Website: ONLINE
    - Etsy: MARKETPLACE
    - Subscription/Membership: SUBSCRIPTION
    - Catering: WHOLESALE
    - Events/Tailgates: EVENT

    **Subscription plans (INFRA-05):**
    - Standard Annual: $75/yr, 1x 5oz monthly + gift bottle, loyalty: 1 month free at 6 months
    - Premium Annual: $125/yr, 1x 10oz monthly + gift bottle, loyalty: 1 month free at 6 months
    - Standard Monthly: $13/mo, 2x 5oz monthly
    - Premium Monthly: $20/mo, 2x 10oz monthly
    - All: cancellation requires 30 days written notice

    **Approval thresholds (INFRA-06):**
    - Under $150: auto-approve
    - $150-$500: single_member approval + notification
    - $500-$2,500: dual_member authorization
    - Over $2,500: dual_bank authorization

    3. Add seed command to `package.json`:
    ```json
    "prisma": {
      "seed": "tsx prisma/seed.ts"
    }
    ```

    4. Run migrations and seed:
    ```bash
    npx prisma migrate dev --name init
    npx prisma db seed
    ```
  </action>
  <verify>
    ```bash
    npx prisma migrate dev --name init
    npx prisma db seed
    npx prisma studio &
    ```
    Prisma Studio shows all tables populated with correct data. Verify:
    - Users table: 2 rows (Anthony, Tunde) with ADMIN role
    - Products table: 6 rows with correct SKUs
    - PricingTiers: multiple rows per product matching PROJECT.md pricing
    - Locations: 7 rows
    - SalesChannels: 9 rows
    - SubscriptionPlans: 4 rows
    - ApprovalThresholds: 4 rows
    - VolumeDiscounts: 3 rows
    - FrequencyDiscounts: 2 rows

    Run seed a second time to confirm idempotency (no errors, no duplicates).
  </verify>
  <done>
    - `npx prisma migrate dev` creates database tables matching all models
    - `npx prisma db seed` populates all reference data without errors
    - Running seed twice produces no errors or duplicates (idempotent)
    - Users table: 2 admin users with hashed passwords
    - Products table: 6 products with correct SKUs, sizes, units per case
    - PricingTiers: All pricing tiers per PROJECT.md (wholesale cash, wholesale net 30, retail)
    - VolumeDiscounts: 3 tiers (1-5, 6-10, 11+)
    - FrequencyDiscounts: 2 tiers (quarterly, annual)
    - Locations: 7 locations with correct types
    - SalesChannels: 9 channels with correct types
    - SubscriptionPlans: 4 plans with correct pricing and benefits
    - ApprovalThresholds: 4 thresholds matching Operating Agreement rules
  </done>
</task>

</tasks>

<verification>
- `npm run dev` starts without errors
- `npx prisma validate` passes
- `npx prisma db seed` runs idempotently
- All 6 products, 7 locations, 9 channels, 2 users, 4 plans, 4 thresholds exist in database
- Tailwind Caribbean color palette available in CSS
- shadcn/ui components installed
</verification>

<success_criteria>
1. Next.js project runs on localhost:3000
2. Prisma schema contains User, Product, PricingTier, VolumeDiscount, FrequencyDiscount, Location, SalesChannel, SubscriptionPlan, ApprovalThreshold, InviteToken, MagicLinkToken models
3. Database seeded with complete reference data matching PROJECT.md exactly
4. Seed script is idempotent (can run multiple times safely)
5. Tailwind configured with Caribbean color palette
6. shadcn/ui initialized and base components available
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
