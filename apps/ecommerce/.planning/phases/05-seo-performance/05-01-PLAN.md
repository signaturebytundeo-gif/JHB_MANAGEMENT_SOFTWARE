---
phase: 05-seo-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/app/sitemap.ts
  - src/app/robots.ts
  - src/app/success/page.tsx
  - src/app/shop/page.tsx
  - src/app/our-story/page.tsx
  - src/app/recipes/page.tsx
  - next.config.ts
autonomous: true

must_haves:
  truths:
    - "Visiting /sitemap.xml returns valid XML listing all pages (home, shop, our-story, recipes, 4 products, 6 recipes)"
    - "Visiting /robots.txt returns valid robots.txt with sitemap reference and disallow for /api/ and /success"
    - "All pages inherit metadataBase for absolute OG image URLs"
    - "Root layout uses title template so child pages append '| Jamaica House Brand'"
    - "Next.js image optimization is configured for WebP/AVIF formats with quality whitelist"
    - "Every page has a unique title and description"
  artifacts:
    - path: "src/app/sitemap.ts"
      provides: "Dynamic sitemap generation from product and recipe data"
      contains: "MetadataRoute.Sitemap"
    - path: "src/app/robots.ts"
      provides: "Robots.txt with sitemap reference and disallow rules"
      contains: "MetadataRoute.Robots"
    - path: "src/app/layout.tsx"
      provides: "Root metadata with metadataBase, title template, keywords, and robots config"
      contains: "metadataBase"
    - path: "next.config.ts"
      provides: "Image optimization config with formats and qualities"
      contains: "qualities"
  key_links:
    - from: "src/app/sitemap.ts"
      to: "src/data/products.ts"
      via: "imports products array for URL generation"
      pattern: "import.*products.*from"
    - from: "src/app/sitemap.ts"
      to: "src/data/recipes.ts"
      via: "imports recipes array for URL generation"
      pattern: "import.*recipes.*from"
---

<objective>
Configure the SEO foundation: root metadata with metadataBase and title template, per-page metadata cleanup, dynamic sitemap.xml, robots.txt, and Next.js image optimization.

Purpose: Without metadataBase, Open Graph images use relative URLs and break on social media. Without sitemap/robots, search engines cannot efficiently discover pages. Without image config, Next.js cannot serve optimized WebP/AVIF formats. Title template ensures consistent branding across all pages.

Output: Updated layout.tsx with comprehensive metadata, sitemap.ts, robots.ts, updated next.config.ts, per-page title cleanup
</objective>

<execution_context>
@/Users/rfmstaff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rfmstaff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/05-seo-performance/05-RESEARCH.md

@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/layout.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/next.config.ts
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/data/products.ts
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/data/recipes.ts
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/shop/page.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/our-story/page.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/recipes/page.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/success/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Root metadata, image config, and per-page title cleanup</name>
  <files>
    src/app/layout.tsx
    next.config.ts
    src/app/success/page.tsx
    src/app/shop/page.tsx
    src/app/our-story/page.tsx
    src/app/recipes/page.tsx
  </files>
  <action>
1. Update the `metadata` export in `src/app/layout.tsx` to:
   ```typescript
   export const metadata: Metadata = {
     metadataBase: new URL('https://jamaicahousebrand.com'),
     title: {
       template: '%s | Jamaica House Brand',
       default: 'Jamaica House Brand - Authentic Jamaican Jerk Sauce',
     },
     description: 'Authentic Jamaican jerk sauce with 30+ years of restaurant heritage. Shop our collection of all-natural, zero-calorie sauces.',
     keywords: ['jerk sauce', 'jamaican sauce', 'authentic jerk', 'caribbean sauce', 'jamaica house brand', 'all natural sauce'],
     authors: [{ name: 'Jamaica House Brand' }],
     openGraph: {
       type: 'website',
       locale: 'en_US',
       siteName: 'Jamaica House Brand',
     },
     twitter: {
       card: 'summary_large_image',
     },
     robots: {
       index: true,
       follow: true,
       googleBot: {
         index: true,
         follow: true,
         'max-image-preview': 'large' as const,
         'max-snippet': -1,
       },
     },
   }
   ```
   IMPORTANT: Do NOT change the JSX body, imports, or component function. Only replace the metadata export object. The layout body will be modified in Plan 03 for analytics scripts.

2. Update `next.config.ts` to add image optimization:
   ```typescript
   const nextConfig: NextConfig = {
     images: {
       formats: ['image/avif', 'image/webp'],
       qualities: [75, 90, 100],
       deviceSizes: [640, 750, 828, 1080, 1200, 1920],
       imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
     },
   }
   ```

3. Fix per-page titles to work with the template (remove redundant brand suffixes):
   - `src/app/shop/page.tsx`: Change title from `'Shop Authentic Jamaican Sauces | Jamaica House Brand'` to `'Shop Authentic Jamaican Sauces'` (template adds the suffix). Keep OpenGraph title as-is.
   - `src/app/our-story/page.tsx`: Change title from `'Our Story - Jamaica House Brand'` to `'Our Story'`. Keep OG.
   - `src/app/recipes/page.tsx`: Change title from `'Recipes - Jamaica House Brand'` to `'Recipes'`. Keep OG.
   - `src/app/success/page.tsx`: Change title from `'Order Confirmed | Jamaica House Brand'` to `'Order Confirmed'`, and add `description: 'Your Jamaica House Brand order has been confirmed. Thank you for your purchase!'` and `robots: { index: false, follow: false }` (don't index success page).

   Note: The homepage (src/app/page.tsx) has a full custom title "Jamaica House Brand - Original Jerk Sauce | 30 Years of Flavor" — leave it as-is since it's the homepage and the default template behavior is fine. Dynamic pages (products/[slug], recipes/[slug]) already use generateMetadata and will work correctly with the template.
  </action>
  <verify>
Run `cd /Users/rfmstaff/Desktop/jamaica-house-brand && npx next build` — build succeeds. Verify layout.tsx contains metadataBase. Verify next.config.ts has `qualities`.
  </verify>
  <done>
Root layout has metadataBase, title template, keywords, authors, OG base, twitter card, robots config. Per-page titles cleaned up to use template. Success page has noindex. next.config.ts has image optimization with AVIF/WebP and quality whitelist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Dynamic sitemap.ts and robots.ts</name>
  <files>
    src/app/sitemap.ts
    src/app/robots.ts
  </files>
  <action>
1. Create `src/app/sitemap.ts`:
   ```typescript
   import type { MetadataRoute } from 'next'
   import { products } from '@/data/products'
   import { recipes } from '@/data/recipes'

   export default function sitemap(): MetadataRoute.Sitemap {
     const baseUrl = 'https://jamaicahousebrand.com'

     const staticPages: MetadataRoute.Sitemap = [
       {
         url: baseUrl,
         lastModified: new Date(),
         changeFrequency: 'monthly',
         priority: 1,
       },
       {
         url: `${baseUrl}/shop`,
         lastModified: new Date(),
         changeFrequency: 'weekly',
         priority: 0.9,
       },
       {
         url: `${baseUrl}/our-story`,
         lastModified: new Date(),
         changeFrequency: 'monthly',
         priority: 0.6,
       },
       {
         url: `${baseUrl}/recipes`,
         lastModified: new Date(),
         changeFrequency: 'weekly',
         priority: 0.7,
       },
     ]

     const productPages: MetadataRoute.Sitemap = products.map((product) => ({
       url: `${baseUrl}/products/${product.slug}`,
       lastModified: new Date(),
       changeFrequency: 'weekly' as const,
       priority: 0.8,
     }))

     const recipePages: MetadataRoute.Sitemap = recipes.map((recipe) => ({
       url: `${baseUrl}/recipes/${recipe.slug}`,
       lastModified: new Date(),
       changeFrequency: 'monthly' as const,
       priority: 0.7,
     }))

     return [...staticPages, ...productPages, ...recipePages]
   }
   ```

2. Create `src/app/robots.ts`:
   ```typescript
   import type { MetadataRoute } from 'next'

   export default function robots(): MetadataRoute.Robots {
     return {
       rules: {
         userAgent: '*',
         allow: '/',
         disallow: ['/api/', '/success'],
       },
       sitemap: 'https://jamaicahousebrand.com/sitemap.xml',
     }
   }
   ```
  </action>
  <verify>
Run `cd /Users/rfmstaff/Desktop/jamaica-house-brand && npx next build` — build succeeds. Verify `src/app/sitemap.ts` and `src/app/robots.ts` exist with correct exports.
  </verify>
  <done>
sitemap.ts generates sitemap.xml with 4 static pages + 4 product URLs + 6 recipe URLs = 14 total entries. robots.ts generates robots.txt allowing all crawlers, disallowing /api/ and /success, and referencing sitemap.xml.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` completes without errors
2. Root layout metadata includes metadataBase, title template, keywords, robots
3. next.config.ts has image optimization config with formats and qualities
4. All pages have unique titles (no duplicate brand suffixes from template)
5. sitemap.ts and robots.ts exist with correct MetadataRoute types
</verification>

<success_criteria>
- Build succeeds with all SEO infrastructure in place
- metadataBase set to https://jamaicahousebrand.com
- Title template applies brand suffix to all child pages
- Image optimization configured for WebP/AVIF with quality whitelist
- Sitemap includes 14+ page URLs
- Robots.txt references sitemap and disallows /api/ and /success
- Success page has robots noindex
</success_criteria>

<output>
After completion, create `.planning/phases/05-seo-performance/05-01-SUMMARY.md`
</output>
